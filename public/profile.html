<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Chatternet — Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --brand:#3498db;--brand-2:#2980b9;--ink:#0f172a;--bg:#f5f7fb;--card:#fff;--muted:#667085;--line:#e6eaf2;
    --ct-bluebar-top:120px;--ct-bluebar-h:58px;--ct-nav-h:44px;--ct-gap:8px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:'Segoe UI',Arial,sans-serif;height:auto;overflow-x:hidden;overflow-y:visible}

  /* Blue header */
  .top-bar{
    position:fixed;left:0;right:0;top:var(--ct-bluebar-top);z-index:70;
    display:flex;justify-content:space-between;align-items:center;
    padding:10px 14px;height:var(--ct-bluebar-h);
    background:linear-gradient(0deg,var(--brand),var(--brand-2));color:#fff;box-shadow:0 2px 10px rgba(0,0,0,.12)
  }
  .top-bar h2{margin:0;font-weight:800}
  .act{display:flex;gap:8px;align-items:center}
  .act .btn{background:rgba(255,255,255,.14);color:#fff;border:1px solid rgba(255,255,255,.25);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:700}
  .act .btn:hover{background:rgba(255,255,255,.22)}
  .act img{width:36px;height:36px;border-radius:50%;border:1px solid rgba(255,255,255,.55);object-fit:cover}

  /* App nav */
  .nav{
    position:fixed;left:0;right:0;top:calc(var(--ct-bluebar-top) + var(--ct-bluebar-h) + var(--ct-gap));
    z-index:65;background:#e9f2ff;border-bottom:1px solid #d7e6ff;
    padding:8px 12px;display:flex;gap:10px;flex-wrap:wrap
  }
  .nav a{color:#0b3a67;text-decoration:none;font-weight:600;border:1px solid #e6eaf2;background:#fff;padding:8px 12px;border-radius:999px}
  .nav a[aria-current="page"]{background:#e8f1ff;border-color:#cfe0ff}
  .nav a:hover{background:#eef4ff}

  .ct-spacer{height:calc(var(--ct-bluebar-h) + var(--ct-nav-h) + var(--ct-gap));}

  .wrap{max-width:1120px;margin:0 auto;padding:0 12px 28px}
  .card{background:var(--card);border:1px solid rgba(0,0,0,.08);border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.08);padding:14px;margin:12px 0 18px}
  .muted{color:var(--muted)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{padding:10px 14px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;cursor:pointer}
  .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
  .btn.primary:hover{background:var(--brand-2)}
  .btn.ghost{background:#f6f9ff;border-color:#e5edff}
  .btn.warn{background:#fee2e2;border-color:#fecaca;color:#991b1b}

  /* Header block */
  .cover{width:100%;height:220px;border-radius:14px;object-fit:cover;background:#e5e7eb}
  .profile-head{display:flex;gap:14px;transform:translateY(-40px);align-items:flex-end}
  .ava{width:96px;height:96px;border-radius:50%;object-fit:cover;border:4px solid #fff;box-shadow:0 4px 12px rgba(0,0,0,.12)}
  .name{font-size:24px;font-weight:900;margin:0}
  .stats{display:flex;gap:10px;flex-wrap:wrap}
  .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #d7d7d7;border-radius:999px;background:#fff;padding:6px 10px;font-weight:600}
  .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
  @media (max-width:900px){ .grid{grid-template-columns:1fr} .profile-head{flex-direction:column;align-items:flex-start;transform:none} }

  /* Tabs */
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
  .tab{background:#fff;border:1px solid #d7d7d7;color:#0f172a;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  .tab.active{background:#e9f2ff;border-color:#b9d6ff;color:#0b63c5}

  /* Lists */
  .list{display:flex;flex-direction:column;gap:10px}
  .item{border:1px solid #e6eaf2;background:#fff;border-radius:12px;padding:10px}
  .post-title{font-weight:800}
  .media-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .thumb{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;background:#eceff3}
  @media (max-width:900px){ .media-grid{grid-template-columns:1fr 1fr} }
  @media (max-width:600px){ .media-grid{grid-template-columns:1fr} }

  /* Modals */
  .modalbg{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:500}
  .sheet{background:#fff;border-radius:12px;max-width:520px;width:92%;max-height:80vh;overflow:auto;box-shadow:0 10px 30px rgba(0,0,0,.3);padding:16px}
</style>
</head>
<body>

<header class="top-bar" id="topBar">
  <h2>Profile</h2>
  <div class="act">
    <button class="btn" id="btnNotif">Notifications</button>
    <button class="btn" id="btnInbox">Inbox</button>
    <button class="btn" id="btnMsgs">Messages</button>
    <img id="meAvatar" alt="Me" />
  </div>
</header>

<nav class="nav" id="appNav">
  <a href="index.html">Home</a>
  <a href="feed.html">Feed</a>
  <a href="friends.html">Friends</a>
  <a href="chattermarket.html">Market</a>
  <a href="groups.html">Groups</a>
  <a href="events.html">Events</a>
  <a href="media.html">Media</a>
  <a href="dating.html">Dating</a>
  <a href="blogs.html">Blogs</a>
  <a href="polls.html">Polls</a>
  <a href="music.html">Music</a>
  <a href="messages.html">Messages</a>
  <a href="profile.html" aria-current="page">Profile</a>
  <a href="settings.html">Settings</a>
</nav>

<div class="ct-spacer" id="ctSpacer"></div>

<div class="wrap">
  <!-- Header card -->
  <section class="card" id="headerCard">
    <img id="coverImg" class="cover" alt="">
    <div class="profile-head">
      <img id="avatarImg" class="ava" alt="">
      <div style="flex:1;min-width:0">
        <h1 class="name" id="dispName">Me</h1>
        <div class="row">
          <div class="pill" id="statPosts">0 Posts</div>
          <div class="pill" id="statMedia">0 Media</div>
          <div class="pill" id="statFriends">0 Friends</div>
        </div>
        <div class="muted" id="bioTxt" style="margin-top:6px"></div>
      </div>
      <div class="row">
        <button class="btn" id="btnFollow">Follow</button>
        <button class="btn primary" id="btnMessage">Message</button>
        <button class="btn ghost" id="btnEdit">Edit Profile</button>
        <a class="btn" id="btnSupport" target="_blank" rel="noopener" style="display:none">Support / Unlock</a>
      </div>
    </div>
  </section>

  <!-- Tabs -->
  <div class="tabs" id="tabs">
    <button class="tab active" data-tab="about">About</button>
    <button class="tab" data-tab="posts">Posts</button>
    <button class="tab" data-tab="media">Media</button>
    <button class="tab" data-tab="friends">Friends</button>
  </div>

  <div class="grid">
    <!-- Left column -->
    <section class="card" id="panel-about">
      <h3 style="margin:0 0 8px;font-size:20px;font-weight:900">About</h3>
      <div class="muted" id="aboutEmpty">Nothing here yet. Add a bio in Settings.</div>
      <div id="aboutBox" style="display:none"></div>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="btnCopyLink">Share profile link</button>
      </div>
    </section>

    <!-- Right column (switchable panels) -->
    <section class="card" id="panel-posts" style="display:none">
      <h3 style="margin:0 0 8px;font-size:20px;font-weight:900">Posts</h3>
      <div id="postsList" class="list"></div>
      <div id="postsEmpty" class="muted">No posts yet.</div>
    </section>

    <section class="card" id="panel-media" style="display:none">
      <h3 style="margin:0 0 8px;font-size:20px;font-weight:900">Media</h3>
      <div id="mediaGrid" class="media-grid"></div>
      <div id="mediaEmpty" class="muted">No media yet.</div>
    </section>

    <section class="card" id="panel-friends" style="display:none">
      <h3 style="margin:0 0 8px;font-size:20px;font-weight:900">Friends</h3>
      <div id="friendsList" class="list"></div>
      <div id="friendsEmpty" class="muted">No friends yet.</div>
    </section>
  </div>
</div>

<!-- Notif / Inbox -->
<div class="modalbg" id="notifBg"><div class="sheet">
  <h3 style="margin:0 0 10px">Notifications</h3>
  <div id="notifList"></div>
  <div class="row" style="margin-top:8px">
    <button id="clearNotif" class="btn primary">Clear</button>
    <button id="closeNotif" class="btn">Close</button>
  </div>
</div></div>
<div class="modalbg" id="inboxBg"><div class="sheet">
  <h3 style="margin:0 0 10px">Inbox</h3>
  <div id="inboxList"></div>
  <div class="row" style="margin-top:8px">
    <button id="closeInbox" class="btn">Close</button>
  </div>
</div></div>

<!-- Positioning under Weebly header -->
<script>
(function(){
  const EXCLUDE=new Set(['topBar','appNav','ctSpacer']);
  const GAP=8, LIFT_UP=22;
  function headerBottom(){
    const sels=['header','.wsite-header','#wsite-header','.site-banner','.wsite-menus','.w-nav','.navbar','.weebly-header','.weebly-nav'];
    let b=0;
    document.querySelectorAll(sels.join(',')).forEach(el=>{
      if(EXCLUDE.has(el.id)) return;
      const r=el.getBoundingClientRect(); b=Math.max(b, r.bottom + window.scrollY);
    });
    return Math.max(b,80);
  }
  function apply(){
    const top=Math.max(0, Math.round(headerBottom()+GAP-LIFT_UP));
    document.documentElement.style.setProperty('--ct-bluebar-top', top+'px');
    const nav=document.getElementById('appNav'); const navH=nav?Math.round(nav.getBoundingClientRect().height):44;
    document.documentElement.style.setProperty('--ct-nav-h', navH+'px');
    const sp=document.getElementById('ctSpacer'); if(sp){ sp.style.height=`calc(var(--ct-bluebar-h) + ${navH}px + var(--ct-gap))`; }
  }
  apply(); window.addEventListener('load',apply,{once:true});
  window.addEventListener('resize',()=>{ clearTimeout(window.__ct_p_rz); window.__ct_p_rz=setTimeout(apply,120); });
  setTimeout(apply,250); setTimeout(apply,900);
})();
</script>

<!-- Messenger loader (messages-only) -->
<script>
(function(){
  function tryLoad(urls,done){(function next(i){if(i>=urls.length){done(false);return}var s=document.createElement('script');s.src=urls[i];s.async=true;s.onload=function(){done(true)};s.onerror=function(){s.remove();next(i+1)};(document.head||document.documentElement).appendChild(s)})(0)}
  var base=(localStorage.getItem('ct_api_base')||'https://chatternet-backend-1.onrender.com').replace(/\/+$/,'');
  var candidates=[base+'/assets/messenger.js','/assets/messenger.js','assets/messenger.js','/messenger.js','messenger.js'];
  tryLoad(candidates,function(ok){
    if(ok && window.ChatternetMessenger && typeof window.ChatternetMessenger.open==='function'){
      window.ctOpen=function(){window.ChatternetMessenger.open(); onlyMessages();};
      window.ctMessage=function(n){window.ChatternetMessenger.open(n||""); onlyMessages();};
      function onlyMessages(){
        try{
          const root=document.querySelector('#ctMessengerRoot,.ct-messenger,[data-ct="messenger"]'); if(!root) return;
          const tab=[...root.querySelectorAll('button,[role="tab"],a')].find(el=>/messages?/i.test(el.textContent||'')); tab && tab.click();
        }catch{}
      }
      setTimeout(onlyMessages,200);
    }
  });
})();
</script>

<script>
/* Storage + helpers */
const LS={
  USERS:'ct_users_v3', PROFILE:'ct_profile_data_v1', SETTINGS:'ct_settings_v1', SETTINGS_GLOBAL:'ct_settings_global',
  FRIENDS:'ct_friend_list_v2', POSTS:'ct_feed_posts_v7', MEDIA:'ct_media_v1', NOTIF:'ct_notifications_v1', INBOX:'ct_inbox_v1'
};
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const load=(k,f)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):f;}catch{return f;}};
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const esc=s=>String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;');

/* Header wiring */
(function(){
  const prof=(load(LS.PROFILE,{}))['Me']||{};
  const img=$('#meAvatar'); if(img){ img.referrerPolicy='no-referrer'; img.src=prof.avatar||prof.avatarUrl||prof.photo||`https://i.pravatar.cc/100?u=me`; img.onclick=()=>location.href='profile.html'; }
  const nbg=$('#notifBg'), ibg=$('#inboxBg');
  function rN(){ const arr=load(LS.NOTIF,[]); $('#notifList').innerHTML=arr.length?arr.map(n=>`<div class="pill" style="display:block">${new Date(n.time).toLocaleString()} — ${esc(n.text||'')}</div>`).join(''):'No notifications yet.'; }
  function rI(){ const arr=load(LS.INBOX,[]); $('#inboxList').innerHTML=arr.length?arr.map(n=>`<div class="pill" style="display:block">${new Date(n.time).toLocaleString()} — ${esc(n.text||'')}</div>`).join(''):'Inbox is empty.'; }
  $('#btnNotif').onclick=()=>{ rN(); nbg.style.display='flex'; };
  $('#clearNotif').onclick=()=>{ save(LS.NOTIF,[]); rN(); };
  $('#closeNotif').onclick=()=>{ nbg.style.display='none'; };
  $('#btnInbox').onclick=()=>{ rI(); ibg.style.display='flex'; };
  $('#closeInbox').onclick=()=>{ ibg.style.display='none'; };
  $('#btnMsgs')?.addEventListener('click',e=>{ e.preventDefault(); if(window.ctOpen) return ctOpen(); if(window.ChatternetMessenger?.open) return window.ChatternetMessenger.open(); location.href='messages.html'; });
})();

/* Seed minimal users to avoid blank */
(function seed(){
  let u=load(LS.USERS,null);
  if(!u){ u=[{name:'Me',avatar:`https://i.pravatar.cc/100?u=me`}]; save(LS.USERS,u); }
})();

/* Profile hydrate */
function stats(){
  $('#statFriends').textContent=(load(LS.FRIENDS,[]).length||0)+' Friends';
  $('#statPosts').textContent=(load(LS.POSTS,[]).length||0)+' Posts';
  $('#statMedia').textContent=(load(LS.MEDIA,[]).length||0)+' Media';
}
function hydrate(){
  const settings = load(LS.SETTINGS, load(LS.SETTINGS_GLOBAL, {}));
  const prof = (load(LS.PROFILE,{}))['Me']||{};
  const displayName = settings?.profile?.displayName || prof.displayName || 'Me';
  const avatar = settings?.profile?.avatarUrl || prof.avatar || `https://i.pravatar.cc/150?u=me`;
  const cover  = settings?.profile?.coverUrl  || prof.cover  || '';
  const bio    = settings?.profile?.bio || prof.bio || '';

  $('#dispName').textContent = displayName;
  const a=$('#avatarImg'); a.src=avatar; a.referrerPolicy='no-referrer';
  const c=$('#coverImg'); if(cover){ c.src=cover; c.referrerPolicy='no-referrer'; } else { c.style.background='#e5e7eb'; }
  $('#bioTxt').textContent = bio || '';
  $('#aboutEmpty').style.display = bio ? 'none':'block';
  $('#aboutBox').style.display = bio ? 'block':'none'; $('#aboutBox').textContent=bio||'';
  stats();

  const pay=settings?.monetization?.paywall?.trim(); const supportBtn=$('#btnSupport');
  if(pay){ supportBtn.href=pay; supportBtn.style.display='inline-flex'; } else supportBtn.style.display='none';
}
hydrate();

/* Actions */
$('#btnEdit').onclick=()=>location.href='settings.html';
$('#btnMessage').onclick=()=>{ if(window.ctOpen) ctOpen(); else if(window.ChatternetMessenger?.open) window.ChatternetMessenger.open(); else location.href='messages.html'; };
$('#btnCopyLink').onclick=async()=>{
  try{ await navigator.clipboard.writeText(location.href.split('#')[0]); alert('Profile link copied'); }catch{ alert('Copy failed'); }
};

/* Follow (local demo) */
(function follow(){
  const KEY='ct_following_me_v1';
  const isFollowing=()=>!!load(KEY,false);
  function render(){ $('#btnFollow').textContent=isFollowing()?'Following':'Follow'; $('#btnFollow').classList.toggle('ghost',isFollowing()); }
  $('#btnFollow').onclick=()=>{ save(KEY,!isFollowing()); render(); };
  render();
})();

/* Tabs + panels */
$('#tabs').addEventListener('click',e=>{
  const t=e.target.closest('.tab'); if(!t) return;
  $$('.tab').forEach(x=>x.classList.toggle('active',x===t));
  ['about','posts','media','friends'].forEach(id=>{
    const show=(id===t.dataset.tab);
    document.getElementById('panel-'+id).style.display=show?'block':'none';
  });
});

/* Populate posts/media/friends from local data */
function renderPosts(){
  const list=$('#postsList'); const empty=$('#postsEmpty'); const arr=load(LS.POSTS,[]);
  list.innerHTML=''; if(!arr.length){ empty.style.display='block'; return; } empty.style.display='none';
  arr.slice().reverse().forEach(p=>{
    const it=document.createElement('div'); it.className='item';
    it.innerHTML=`<div class="post-title">${esc(p.title||'(post)')}</div><div class="muted" style="font-size:12px;margin:4px 0">${new Date(p.time||p.createdAt||Date.now()).toLocaleString()}</div><div>${esc(p.text||p.content||'')}</div>`;
    list.appendChild(it);
  });
}
function renderMedia(){
  const grid=$('#mediaGrid'); const empty=$('#mediaEmpty'); const arr=load(LS.MEDIA,[]);
  grid.innerHTML=''; if(!arr.length){ empty.style.display='block'; return; } empty.style.display='none';
  arr.slice().reverse().forEach(m=>{
    const img=document.createElement('img'); img.className='thumb'; img.referrerPolicy='no-referrer'; img.alt='';
    img.src=m.url || m.src || m.dataUrl || '';
    grid.appendChild(img);
  });
}
function renderFriends(){
  const box=$('#friendsList'); const empty=$('#friendsEmpty'); const arr=load(LS.FRIENDS,[]);
  box.innerHTML=''; if(!arr.length){ empty.style.display='block'; return; } empty.style.display='none';
  arr.forEach(n=>{
    const row=document.createElement('div'); row.className='item';
    row.innerHTML=`<div class="row" style="justify-content:space-between"><div class="row"><img alt="" class="ava" style="width:40px;height:40px;border:1px solid #e5e7eb" referrerpolicy="no-referrer" src="https://i.pravatar.cc/100?u=${encodeURIComponent(n)}"><div><div style="font-weight:800">${esc(n)}</div><div class="muted" style="font-size:12px">@${esc(n.toLowerCase().replace(/\s+/g,'.'))}</div></div></div><button class="btn" onclick="location.href='messages.html'">Message</button></div>`;
    box.appendChild(row);
  });
}
renderPosts(); renderMedia(); renderFriends();

/* Keep UI synced across tabs */
window.addEventListener('storage',(ev)=>{ if([LS.SETTINGS,LS.SETTINGS_GLOBAL,LS.PROFILE,LS.POSTS,LS.MEDIA,LS.FRIENDS].includes(ev.key)){ hydrate(); stats(); renderPosts(); renderMedia(); renderFriends(); }});
</script>

</body>
</html>
