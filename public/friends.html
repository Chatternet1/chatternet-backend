<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Friends — Chatternet</title>

<style>
  :root{
    /* Set precisely by the script below (same as Feed) */
    --blueTop: 132px;   /* distance from top of page to blue bar */
    --barH: 52px;       /* measured height of blue bar */
    --navH: 48px;       /* measured height of app nav */
    --pagePad: calc(var(--blueTop) + var(--barH) + var(--navH));
  }
  html,body{margin:0;padding:0;background:#f5f7fb;color:#0f172a;
    font:14px/1.45 "Segoe UI", Arial, system-ui, -apple-system, sans-serif}
  a{color:#2563eb;text-decoration:none}
  *{box-sizing:border-box}

  /* Fixed blue bar (no scrolling) */
  .top-bar{
    position:fixed; left:0; right:0; top:var(--blueTop); z-index:1200;
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 14px; background:#0ea5e9; color:#fff;
    border-bottom:1px solid rgba(255,255,255,.2);
  }
  .top-bar h2{margin:0;font-size:18px;font-weight:700}
  .top-actions{display:flex;gap:10px;align-items:center}
  .pillbtn{
    height:36px;padding:0 12px;border-radius:999px;cursor:pointer;
    border:1px solid rgba(255,255,255,.7);background:rgba(255,255,255,.15);color:#fff
  }
  .pillbtn:hover{background:rgba(255,255,255,.26)}
  #meAvatar{width:36px;height:36px;border-radius:999px;border:2px solid rgba(255,255,255,.7);object-fit:cover;cursor:pointer}

  /* App nav — fixed under the blue bar */
  nav.app-nav{
    position:fixed; left:0; right:0;
    top:calc(var(--blueTop) + var(--barH));
    z-index:1190; background:#fff; border-bottom:1px solid #e6eaf2;
  }
  nav.app-nav .inner{max-width:1100px;margin:0 auto;display:flex;gap:10px;flex-wrap:wrap;padding:8px 12px}
  nav.app-nav a{
    display:inline-block !important; padding:8px 10px !important; border-radius:999px !important;
    color:#111 !important; background:#f3f4f6 !important; text-decoration:none !important;
    line-height:1 !important; font-weight:500 !important;
  }
  nav.app-nav a.active{background:#dbeafe !important; color:#1e3a8a !important}
  nav.app-nav a:hover{background:#e5e7eb !important}

  /* Page content sits below the fixed headers (single scroll) */
  .page{
    max-width:1100px;margin:14px auto;padding:0 12px;
    padding-top: var(--pagePad);   /* □ same technique as Feed */
    position:relative; z-index:1;
  }

  .card{background:#fff;border:1px solid #e6eaf2;border-radius:14px;padding:14px;box-shadow:0 4px 12px rgba(15,23,42,.03)}
  .row{display:flex;gap:8px;align-items:center}
  .muted{color:#6b7280}

  /* Tabs */
  .tabs{display:flex;gap:8px;margin:0 0 10px}
  .tab{padding:8px 12px;border:1px solid #d7d7d7;border-radius:999px;background:#fff;cursor:pointer}
  .tab.active{background:#0ea5e9;border-color:#0ea5e9;color:#fff}
  .panels .panel{display:none}
  .panels .panel.active{display:block}

  /* Lists */
  .list{display:flex;flex-direction:column;gap:8px}
  .item{display:flex;gap:10px;align-items:center;border:1px solid #e6eaf2;border-radius:12px;padding:10px}
  .item .ava{width:44px;height:44px;border-radius:999px;object-fit:cover;border:1px solid #e4e4e7}
  .title{font-weight:600}
  .handle{font-size:12px;color:#6b7280}
  .btn{padding:8px 12px;border:1px solid #d7d7d7;border-radius:999px;background:#fff;cursor:pointer}
  .btn.primary{background:#3b82f6;border-color:#3b82f6;color:#fff}
  .btn.warn{border-color:#ef4444;color:#b91c1c}
  .search{flex:1 1 auto;padding:8px 12px;border:1px solid #d7d7d7;border-radius:12px}

  /* Modals */
  .modalbg{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:4000}
  .sheet{background:#fff;border-radius:12px;max-width:520px;width:92%;max-height:80vh;overflow:auto;box-shadow:0 10px 30px rgba(0,0,0,.3);padding:16px}
  .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #e6eaf2;background:#f8fafc;border-radius:999px;padding:4px 10px;font-size:12px}
</style>

<!-- EXACT same positioner used on Feed -->
<script>
(function(){
  var GAP = 12;
  var MENU_SELS = [
    '.wsite-nav','.wsite-menu-default','.wsite-menus',
    '.w-nav','.nav-wrapper','.navbar',
    '.siteHeader .nav','.desktop-nav','.top-nav',
    'nav[role="navigation"]','.site-navigation'
  ];
  function pickMenuBottom(){
    var bottoms=[];
    for(var i=0;i<MENU_SELS.length;i++){
      var el=document.querySelector(MENU_SELS[i]); if(!el) continue;
      var r=el.getBoundingClientRect(), h=r.height, w=r.width;
      var plausible = h>=32 && h<=140 && r.top>-20 && r.top<200 && w>300;
      if(plausible) bottoms.push(Math.round(r.bottom));
    }
    var best = bottoms.length ? Math.min.apply(null,bottoms) : 120;
    if(best>240) best=120;
    try{ var force=localStorage.getItem('ct_force_header_px'); if(force) best=parseInt(force,10)||best; }catch(e){}
    return best;
  }
  function measure(el, fb){ if(!el) return fb; var r=el.getBoundingClientRect(); return Math.max(fb, Math.round(r.height)); }
  function apply(){
    var blueTop = pickMenuBottom() + GAP;
    var barH = measure(document.querySelector('.top-bar'), 50);
    var navH = measure(document.querySelector('nav.app-nav'), 46);
    var root = document.documentElement;
    root.style.setProperty('--blueTop', blueTop+'px');
    root.style.setProperty('--barH', barH+'px');
    root.style.setProperty('--navH', navH+'px');
    root.style.setProperty('--pagePad', (blueTop+barH+navH)+'px');
  }
  if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', apply); } else { apply(); }
  addEventListener('load', apply, {once:true});
  addEventListener('resize', apply, {passive:true});
  addEventListener('orientationchange', apply, {passive:true});
  setTimeout(apply, 0); setTimeout(apply, 250); setTimeout(apply, 800);
})();
</script>
</head>
<body>

<!-- Fixed blue bar -->
<div class="top-bar" role="banner" aria-label="Page header">
  <h2>Friends</h2>
  <div class="top-actions">
    <button id="btnNotif" class="pillbtn">Notifications</button>
    <button id="btnInbox" class="pillbtn">Inbox</button>
    <button id="btnMsgs" class="pillbtn">Messages</button>
    <img id="meAvatar" alt="My Profile" title="My Profile" />
  </div>
</div>

<!-- Fixed App Nav -->
<nav class="app-nav" aria-label="Site">
  <div class="inner">
    <a href="index.html">Home</a>
    <a href="feed.html">Feed</a>
    <a class="active" href="friends.html" aria-current="page">Friends</a>
    <a href="chattermarket.html">Market</a>
    <a href="groups.html">Groups</a>
    <a href="events.html">Events</a>
    <a href="media.html">Media</a>
    <a href="dating.html">Dating</a>
    <a href="blogs.html">Blogs</a>
    <a href="polls.html">Polls</a>
    <a href="music.html">Music</a>
    <a href="messages.html">Messages</a>
    <a href="profile.html">Profile</a>
    <a href="settings.html">Settings</a>
  </div>
</nav>

<!-- Page -->
<div class="page">
  <section class="card">
    <!-- Tabs -->
    <div id="tabs" class="tabs">
      <button class="tab active" data-tab="people">People</button>
      <button class="tab" data-tab="requests">Requests</button>
      <button class="tab" data-tab="friends">Friends</button>
    </div>

    <div class="panels">
      <!-- People -->
      <section id="p-people" class="panel active">
        <div class="row" style="margin-bottom:8px">
          <input id="pSearch" class="search" placeholder="Search people…">
          <button id="pClear" class="btn" type="button">Clear</button>
          <div class="muted" style="margin-left:auto"><strong id="pCount">0</strong> people</div>
        </div>
        <div id="pList" class="list"></div>
      </section>

      <!-- Requests -->
      <section id="p-requests" class="panel">
        <h3 class="section-title" style="margin:0 0 8px">Incoming</h3>
        <div id="rInList" class="list" style="margin-bottom:10px"></div>
        <h3 class="section-title" style="margin:10px 0 8px">Outgoing</h3>
        <div id="rOutList" class="list"></div>
      </section>

      <!-- Friends -->
      <section id="p-friends" class="panel">
        <div class="muted" style="margin:0 0 8px"><strong id="fCount">0</strong> friends</div>
        <div id="fList" class="list"></div>
      </section>
    </div>
  </section>
</div>

<!-- Notifications / Inbox Modals -->
<div class="modalbg" id="notifBg">
  <div class="sheet">
    <h3 class="section-title" style="margin:0 0 10px">Notifications</h3>
    <div id="notifList"></div>
    <div class="row" style="margin-top:8px">
      <button id="clearNotif" class="btn primary">Clear</button>
      <button id="closeNotif" class="btn">Close</button>
    </div>
  </div>
</div>

<div class="modalbg" id="inboxBg">
  <div class="sheet">
    <h3 class="section-title" style="margin:0 0 10px">Inbox</h3>
    <div id="inboxList"></div>
    <div class="row" style="margin-top:8px">
      <button id="closeInbox" class="btn">Close</button>
    </div>
  </div>
</div>

<script>
/* ===== Keys & helpers ===== */
const LS = {
  USERS:'ct_users_v3', PROFILE:'ct_profile_data_v1',
  NOTIF:'ct_notifications_v1', INBOX:'ct_inbox_v1',
  FRIENDS:'ct_friend_list_v2', IN_REQ:'ct_friend_requests_in_v2', OUT_REQ:'ct_friend_requests_out_v2'
};
const $=s=>document.querySelector(s);
const load=(k,f)=>{ try{const v=localStorage.getItem(k);return v?JSON.parse(v):f;}catch{return f;} };
const save=(k,v)=>{ try{ localStorage.setItem(k,JSON.stringify(v)); }catch{} };
const nowISO=()=>new Date().toISOString();
const uid=(p='id')=>p+'_'+Date.now().toString(36)+'_'+Math.random().toString(36).slice(2,7);
const esc=s=>String(s||'').replace(/[&<>"]/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;' }[c]))+"";
const face=n=>`https://i.pravatar.cc/100?u=${encodeURIComponent(n||'me')}`;

/* ===== Header wiring ===== */
(function header(){
  const prof=(load(LS.PROFILE,{}))['Me']||{};
  const img=$('#meAvatar'); if(img){ img.referrerPolicy='no-referrer'; img.loading='lazy';
    img.src=prof.avatar||face('Me'); img.alt='Me';
    img.onclick=()=>{ try{localStorage.setItem('ct_profile_view_v1',JSON.stringify({name:'Me'}));}catch{}; location.href='profile.html'; };
  }
  document.getElementById('btnMsgs').onclick=(e)=>{ e.preventDefault();
    if(window.ChatternetMessenger?.open) return window.ChatternetMessenger.open();
    if(window.ctOpen) return window.ctOpen(); location.href='messages.html';
  };

  const nbg=document.getElementById('notifBg'), ibg=document.getElementById('inboxBg');
  function rN(){ const arr=load(LS.NOTIF,[]); document.getElementById('notifList').innerHTML=arr.length?arr.map(n=>`<div class="pill" style="display:block;margin:4px 0">${new Date(n.time).toLocaleString()} — ${esc(n.text||'')}</div>`).join(''):'No notifications yet.'; }
  function rI(){ const arr=load(LS.INBOX,[]); document.getElementById('inboxList').innerHTML=arr.length?arr.map(n=>`<div class="pill" style="display:block;margin:4px 0">${new Date(n.time).toLocaleString()} — ${esc(n.text||'')}</div>`).join(''):'Inbox is empty.'; }
  document.getElementById('btnNotif').onclick=()=>{ rN(); nbg.style.display='flex'; };
  document.getElementById('clearNotif').onclick=()=>{ save(LS.NOTIF,[]); rN(); };
  document.getElementById('closeNotif').onclick=()=>{ nbg.style.display='none'; };
  document.getElementById('btnInbox').onclick=()=>{ rI(); ibg.style.display='flex'; };
  document.getElementById('closeInbox').onclick=()=>{ ibg.style.display='none'; };
})();

/* ===== Data accessors ===== */
const users   = ()=>load(LS.USERS, []);
const friends = ()=>load(LS.FRIENDS, []);
const reqIn   = ()=>load(LS.IN_REQ, []);
const reqOut  = ()=>load(LS.OUT_REQ, []);

function addOutgoing(name){ const a=reqOut(); if(!a.includes(name)) a.unshift(name); save(LS.OUT_REQ,a); }
function addIncoming(name){ const a=reqIn();  if(!a.includes(name)) a.unshift(name); save(LS.IN_REQ,a); }
function removeOutgoing(name){ save(LS.OUT_REQ, reqOut().filter(n=>n!==name)); }
function removeIncoming(name){ save(LS.IN_REQ, reqIn().filter(n=>n!==name)); }
function addFriend(name){ const a=friends(); if(!a.includes(name)) a.unshift(name); save(LS.FRIENDS,a); }
function removeFriend(name){ save(LS.FRIENDS, friends().filter(n=>n!==name)); }
function addNotif(t){ const a=load(LS.NOTIF,[]); a.unshift({id:uid('n'),text:t,time:nowISO()}); save(LS.NOTIF,a); }

/* ===== UI ===== */
function personRow(name, actions){
  const el=document.createElement('div'); el.className='item'; el.dataset.name=name;
  el.innerHTML=`
    <img class="ava" src="${face(name)}" alt="">
    <div style="flex:1;min-width:0">
      <div class="title">${esc(name)}</div>
      <div class="handle">@${esc(String(name).toLowerCase().replace(/\s+/g,'.'))}</div>
    </div>
    <div class="row" style="flex:0 0 auto;gap:6px"></div>`;
  const slot=el.querySelector('.row:last-child');
  (actions||[]).forEach(a=>slot.appendChild(a));
  return el;
}
const pillBtn=(text,klass,fn)=>{ const b=document.createElement('button'); b.className='btn'+(klass?(' '+klass):''); b.textContent=text; if(fn) b.onclick=fn; return b; };

/* ===== Renders ===== */
function renderPeople(){
  const q=(document.getElementById('pSearch').value||'').trim().toLowerCase();
  const fset=new Set(friends()), inset=new Set(reqIn()), outset=new Set(reqOut());
  const avail=users().map(u=>u.name)
    .filter(n=>n && n!=='Me' && !fset.has(n) && !inset.has(n) && !outset.has(n))
    .filter(n=>!q || n.toLowerCase().includes(q));

  document.getElementById('pCount').textContent=avail.length;
  const box=document.getElementById('pList'); box.innerHTML='';
  if(!avail.length){ box.innerHTML='<div class="muted">No people to show.</div>'; return; }

  avail.forEach(n=>{
    const add=pillBtn('Add friend','primary',()=>{ addOutgoing(n); addNotif(`Friend request sent to ${n}.`); renderAll(); });
    const view=pillBtn('Message','',()=>{ if(window.ctMessage) ctMessage(n); else location.href='messages.html'; });
    box.appendChild(personRow(n,[add,view]));
  });
}
function renderRequests(){
  const inBox = document.getElementById('rInList'); const outBox = document.getElementById('rOutList');
  inBox.innerHTML=''; outBox.innerHTML='';
  const inArr=reqIn(); const outArr=reqOut();
  if(!inArr.length) inBox.innerHTML='<div class="muted">No incoming requests.</div>';
  inArr.forEach(n=>{
    const accept=pillBtn('Accept','primary',()=>{ removeIncoming(n); addFriend(n); addNotif(`You are now friends with ${n}.`); renderAll(); });
    const decline=pillBtn('Decline','warn',()=>{ removeIncoming(n); renderAll(); });
    inBox.appendChild(personRow(n,[accept,decline]));
  });
  if(!outArr.length) outBox.innerHTML='<div class="muted">No outgoing requests.</div>';
  outArr.forEach(n=>{
    const cancel=pillBtn('Cancel','warn',()=>{ removeOutgoing(n); renderAll(); });
    outBox.appendChild(personRow(n,[cancel]));
  });
}
function renderFriends(){
  const box=document.getElementById('fList'); const arr=friends(); document.getElementById('fCount').textContent=arr.length; box.innerHTML='';
  if(!arr.length){ box.innerHTML='<div class="muted">No friends yet.</div>'; return; }
  arr.forEach(n=>{
    const msg=pillBtn('Message','',()=>{ if(window.ctMessage) ctMessage(n); else location.href='messages.html'; });
    const un=pillBtn('Unfriend','warn',()=>{ removeFriend(n); renderAll(); });
    box.appendChild(personRow(n,[msg,un]));
  });
}
function renderAll(){ renderPeople(); renderRequests(); renderFriends(); }

/* ===== Tabs & Search ===== */
document.getElementById('tabs').addEventListener('click',e=>{
  const t=e.target.closest('.tab'); if(!t) return;
  document.querySelectorAll('.tab').forEach(x=>x.classList.toggle('active',x===t));
  document.querySelectorAll('.panel').forEach(p=>p.classList.toggle('active', p.id==='p-'+t.dataset.tab));
});
document.getElementById('pSearch').addEventListener('input', renderPeople);
document.getElementById('pClear').addEventListener('click', ()=>{ document.getElementById('pSearch').value=''; renderPeople(); });

/* ===== Seed demo (19 names like the reference) ===== */
(function seed(){
  let u=load(LS.USERS,null);
  const want = [
    'Me','Emma Davis','Ethan Brooks','Olivia Perez','Logan Price','Mia Carter','Lucas Reed','Chloe Evans','Henry Scott',
    'Amelia Ross','Elijah Gray','Isabella Wood','James Hall','Luna Kelly','Benjamin Ward','Aria King','Michael Reed',
    'Jason Brooks','Daniel Foster','Echo Bot'
  ];
  if(!u || !Array.isArray(u) || u.length < 10){
    u = want.map(n=>({name:n,avatar:face(n)}));
    save(LS.USERS,u);
  }
  if(!localStorage.getItem('ct_demo_friendreq_v2')){
    addIncoming('Emma Davis'); localStorage.setItem('ct_demo_friendreq_v2','1');
  }
})();
renderAll();
</script>

<!-- Universal footer-style loader (keeps your real server) -->
<script>
(function(){
  "use strict";
  var BASE=(window.CT_API_BASE || localStorage.getItem('ct_api_base') || 'https://chatternet-backend-1.onrender.com').replace(/\/+$/,'');
  window.CT_API_BASE = BASE; try{ localStorage.setItem('ct_api_base', BASE); }catch{}
  function tryLoad(list, done){
    (function next(i){ if(i>=list.length){ done(false); return; }
      var s=document.createElement('script'); s.src=list[i]; s.async=true;
      s.onload=function(){ done(true); }; s.onerror=function(){ s.remove(); next(i+1); };
      (document.head||document.documentElement).appendChild(s);
    })(0);
  }
  var commonPaths=[ BASE+'/assets/common.js','/assets/common.js','assets/common.js' ];
  var msgPaths   =[ BASE+'/assets/messenger.js','/assets/messenger.js','assets/messenger.js','/messenger.js','messenger.js' ];
  tryLoad(commonPaths, function(){ tryLoad(msgPaths, function(){
    if(!window.ctOpen){
      window.ctOpen = function(){
        if(window.ChatternetMessenger && typeof window.ChatternetMessenger.open==='function') return window.ChatternetMessenger.open();
        location.href='messages.html';
      };
    }
    if(!window.ctMessage) window.ctMessage = window.ctOpen;
    document.addEventListener('click', function(e){
      var a=e.target.closest && e.target.closest('a[href*="messages.html"]'); if(!a) return;
      if(window.ctOpen || (window.ChatternetMessenger && window.ChatternetMessenger.open)){
        e.preventDefault(); (window.ctOpen || window.ChatternetMessenger.open)();
      }
    }, true);
  }); });
})();
</script>

</body>
</html>
